version: 2.1

jobs: 
  build:
    macos:
      xcode: 14.1.0
    steps:
      - checkout
      - run:
          name: Build Frameworks
          command: scripts/buildPrebidMobile.sh -b no

  unit-test:
    macos:
      xcode: 14.1.0
    steps:
      - checkout
      - run:
          name: Run Unit Tests for Frameworks
          command: scripts/testPrebidMobile.sh -l
          
  run-swift-demo-app-integration-tests:
    macos:
      xcode: 14.1.0
    steps:
      - checkout
      - run:
          name: Run Integration Tests
          command: scripts/testPrebidDemo.sh -l
          
  run-swift-demo-app-smoke-ui-tests:
      macos:
        xcode: 13.2.0
      steps:
        - checkout
        - run:
            name: Run Smoke Ui Tests
            command: scripts/testPrebidDemo.sh -ui -l
        - run:
             name: Save test results
             command: scripts/uploadLogsFile.sh
        - store_artifacts:
            path: /tmp/app_logs

workflows:
  pr-check:
    jobs: 
      - build:
         name: Build PrebidMobile Frameworks
      - unit-test:
         name: Run Unit Tests for PrebidMobile Frameworks
      - run-swift-demo-app-integration-tests:
         name: Run Integration Tests - Swift Demo App
      - run-swift-demo-app-smoke-ui-tests:
         name: Run Smoke Ui Tests - Swift Demo App
      
